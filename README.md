# Face Recognition Attendance System

Production-grade Face Recognition Attendance System in Kotlin using Android Studio, Firebase ML Kit for face detection, and Firebase Realtime Database for attendance tracking.

## Features

✅ Firebase Authentication with Role-Based Access Control  
✅ Multi-face Student Registration (5-8 photos)  
✅ Real-time Face Recognition & Attendance Marking  
✅ Advanced Liveness Detection  
✅ Firebase Storage with Image Compression  
✅ Offline-first Architecture with Room Database  
✅ Analytics Dashboard with Reports  
✅ Kotlin Coroutines for Async Operations  
✅ Hilt Dependency Injection  
✅ Material Design 3 UI  
✅ Complete Error Handling with Result Sealed Class  

## Technical Stack

- **Language**: Kotlin (SDK 21+, Target 34)
- **Build Tool**: Gradle 8.0+
- **Face Detection**: Firebase ML Kit
- **Face Recognition**: TensorFlow Lite + FaceNet
- **Backend**: Firebase (Auth, Realtime DB, Storage, Cloud Functions)
- **Local DB**: Room
- **Image Processing**: CameraX API
- **Async**: Kotlin Coroutines
- **DI**: Hilt
- **UI**: Material Design 3

## Project Structure

```
app/src/main/kotlin/com/attendance/facerec/
├── presentation/          # UI Layer (Activities, Fragments, ViewModels)
├── domain/               # Business Logic (Models, Use Cases)
├── data/                 # Data Layer (Repositories, DB, API)
├── service/              # Background Services
├── util/                 # Utilities & Constants
└── FaceRecognitionApp.kt # Application Entry Point
```

## Getting Started

### Prerequisites

- **Android Studio Giraffe (2022.3.1) or later**
- **JDK 17+**
- **Kotlin 1.9.20+**
- **Firebase Project** with Authentication, Realtime Database, and Storage enabled
- **Google Cloud Project** for ML Kit

### Installation

#### 1. Clone the Repository

```bash
git clone https://github.com/preethamdev05/face-recognition-attendance.git
cd face-recognition-attendance
```

#### 2. Configure Firebase

**a. Download Firebase Configuration:**
- Go to [Firebase Console](https://console.firebase.google.com/)
- Select your project
- Go to **Project Settings** → **Your Apps** → **Android App**
- Download `google-services.json`
- **Place it in `app/` directory** (root of app module)

**b. Configure Local Properties:**

```bash
# Copy the example file
cp local.properties.example local.properties
```

Edit `local.properties` and add your Firebase credentials:

```properties
# Firebase Configuration
firebase.database.url=https://your-project-id.firebaseio.com
firebase.storage.bucket=your-project-id.appspot.com

# Android SDK (auto-generated by Android Studio)
sdk.dir=/path/to/Android/sdk
```

**⚠️ IMPORTANT:** Never commit `local.properties` or `google-services.json` to version control. They are git-ignored by default.

#### 3. Install Git Hooks (Code Quality)

```bash
cp pre-commit .git/hooks/pre-commit
chmod +x .git/hooks/pre-commit
```

This enforces ktlint and detekt checks before every commit.

#### 4. Sync and Build

Open the project in Android Studio and let Gradle sync. Then:

```bash
# Run static analysis
./gradlew ktlintCheck detekt

# Build debug APK
./gradlew assembleDebug

# Build release APK
./gradlew assembleRelease

# Install on connected device
./gradlew installDebug
```

## Architecture

Follows **Clean Architecture + MVVM** pattern:

### Layers

```
┌─────────────────────────────────────┐
│     Presentation Layer (UI)         │
│  Activities, Fragments, ViewModels  │
└─────────────────┬───────────────────┘
                  │
┌─────────────────▼───────────────────┐
│       Domain Layer (Logic)          │
│   Models, Use Cases, Interfaces     │
└─────────────────┬───────────────────┘
                  │
┌─────────────────▼───────────────────┐
│      Data Layer (Sources)           │
│  Repositories, Room DB, Firebase    │
└─────────────────────────────────────┘
```

### Key Patterns

- **MVVM**: Separation of UI and business logic
- **Repository Pattern**: Abstract data sources
- **Dependency Injection**: Hilt for loose coupling
- **Coroutines**: Async operations with structured concurrency
- **StateFlow**: Reactive state management
- **Result Sealed Class**: Type-safe error handling

## Key Components

### Authentication
- Email/Password Login
- Phone Number Authentication
- Two-Factor Authentication (OTP)
- Biometric Authentication (Fingerprint/Face)

### Student Registration
- Multi-angle Face Capture (5-8 photos)
- Image Validation (Size, Quality, Lighting)
- Liveness Detection (Prevents photo spoofing)
- Facial Encoding Generation (128D embeddings)

### Attendance Marking
- Real-time Camera Feed (30fps)
- Face Detection (ML Kit)
- Face Recognition (FaceNet + cosine similarity)
- Location Tracking (GPS verification)
- Confidence Scoring (>60% threshold)
- Duplicate Prevention (5-minute window lock)

### Dashboard
- Attendance Summary (Present/Late/Absent)
- Real-time Analytics
- PDF/Excel Report Export
- Trend Analysis & Charts

## Database Schema

### Firebase Realtime Database

```
attendance-system/
├── students/{studentId}/
│   ├── name: string
│   ├── email: string
│   ├── enrollmentDate: timestamp
│   └── faceEncodings: [float128[]]
│
├── attendance/{classId}/{date}/{studentId}/
│   ├── timestamp: long
│   ├── status: "present"|"late"|"absent"
│   ├── confidence: float
│   └── location: {lat, lng}
│
├── classes/{classId}/
│   ├── name: string
│   ├── instructor: string
│   └── schedule: {}
│
└── admins/{adminId}/
    ├── role: "admin"|"instructor"
    └── permissions: []
```

### Room Local Database

- **AttendanceEntity**: Offline cache for sync
- **StudentEntity**: Student profiles
- **ClassEntity**: Class information

## Testing

### Run Tests

```bash
# Unit tests
./gradlew test

# Instrumented tests (requires device/emulator)
./gradlew connectedAndroidTest

# Specific test class
./gradlew test --tests FaceRecognitionTest

# Code coverage
./gradlew jacocoTestReport
```

### Static Analysis

```bash
# Kotlin linting (auto-format)
./gradlew ktlintFormat

# Kotlin linting (check only)
./gradlew ktlintCheck

# Detekt (code smells)
./gradlew detekt

# All checks
./gradlew check
```

## Performance Metrics

- **Image Compression**: 70% size reduction (85% JPEG quality)
- **Face Detection**: <500ms per frame (ML Kit)
- **Face Recognition**: <2 seconds end-to-end
- **Batch Upload**: 50 records per transaction
- **Pagination**: 50 records per page
- **App Size**: ~15MB (release APK with R8)

## Security

### Implemented Security Measures

- ✅ **AES-256-GCM Encryption** for sensitive data at rest
- ✅ **HTTPS-only** Firebase connections (TLS 1.3)
- ✅ **Firebase Security Rules** with role-based access control
- ✅ **API Key Restrictions** (Android package name + SHA-1)
- ✅ **Network Security Config** (blocks cleartext traffic)
- ✅ **Root Detection** (graceful UX, no crash)
- ✅ **ProGuard/R8 Obfuscation** (release builds)
- ✅ **No Hardcoded Secrets** (BuildConfig injection)
- ✅ **Firebase Crashlytics** (crash reporting)
- ✅ **Audit Logging** for admin actions

### Reporting Security Issues

**DO NOT** open public GitHub issues for vulnerabilities. See [SECURITY.md](SECURITY.md) for responsible disclosure.

## Contributing

We welcome contributions! Please read [CONTRIBUTING.md](CONTRIBUTING.md) before submitting PRs.

### Quick Start for Contributors

1. Fork the repository
2. Create a feature branch: `git checkout -b feat/amazing-feature`
3. Follow coding standards (ktlint + detekt)
4. Write tests for new features
5. Commit using Conventional Commits: `git commit -m "feat: add feature"`
6. Push and open a PR

## License

MIT License - See [LICENSE](LICENSE) file for details.

## Support

- **Issues**: [GitHub Issues](https://github.com/preethamdev05/face-recognition-attendance/issues)
- **Email**: support@attendance-system.dev
- **Documentation**: [Wiki](https://github.com/preethamdev05/face-recognition-attendance/wiki)

## Acknowledgments

- Firebase ML Kit for face detection
- TensorFlow Lite for FaceNet inference
- CameraX for modern camera API
- Hilt for dependency injection
- Material Design 3 for UI components

---

**Built with ❤️ using Kotlin and Firebase**
